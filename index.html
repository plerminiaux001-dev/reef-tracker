<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reef Tank Dashboard & Dosing Calculator</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --bg: #f4f4f9; --card: #ffffff; --primary: #007bff; --text: #333; --active-tab: #0056b3; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background: var(--bg); color: var(--text); padding: 20px; max-width: 1000px; margin: 0 auto; }
        h1, h2, h3 { color: #2c3e50; margin-top: 0; }
        
        /* Grid Layouts */
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 20px; }
        .grid-small { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 15px; }
        
        /* Card Styling */
        .card { background: var(--card); padding: 20px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .card.highlight { border-top: 5px solid var(--primary); }
        
        /* Tab Navigation Styles */
        .tab-nav { display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 2px solid #ddd; padding-bottom: 10px; }
        .tab-btn { background: #e9ecef; color: #555; border: none; padding: 12px 25px; border-radius: 5px; cursor: pointer; font-size: 1em; font-weight: bold; transition: 0.3s; flex: 1; max-width: 200px; text-align: center; }
        .tab-btn:hover { background: #dcdcdc; }
        .tab-btn.active { background: var(--primary); color: white; }
        
        /* Hide tab content by default */
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* Form Styles */
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; font-size: 0.9em; }
        input { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; }
        button { background: var(--primary); color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-size: 1em; width: 100%; }
        button:hover { background: #0056b3; }
        button.delete { background: #dc3545; margin-top: 10px; }

        /* Status Indicators */
        .status-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
        .status-box { padding: 10px; border-radius: 5px; text-align: center; color: white; font-weight: bold; }
        .good { background: #28a745; }
        .warn { background: #ffc107; color: #333; }
        .bad { background: #dc3545; }

        /* Calculator Output */
        #calc-results { margin-top: 20px; padding: 15px; background: #e9ecef; border-left: 5px solid #007bff; display: none; }
        .calc-highlight { font-weight: bold; color: #d63384; }
        
        /* Tables */
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th, td { text-align: left; padding: 8px; border-bottom: 1px solid #ddd; }
        th { background-color: #f8f9fa; }
        
        /* Recipe Table (New) */
        .recipe-table td { font-weight: bold; color: #555; }
        .recipe-table td:last-child { color: var(--primary); font-size: 1.1em; text-align: right; }

        /* Instruction Dosing Cards */
        .dose-card { background: #f8f9fa; padding: 15px; border-radius: 8px; border: 1px solid #eee; text-align: center; }
        .dose-amt { font-size: 1.5em; font-weight: bold; color: var(--primary); margin: 10px 0; }
        .dose-chem { font-size: 0.85em; color: #666; font-style: italic; margin-bottom: 5px; }
        .dose-label { font-weight: bold; color: #2c3e50; }
    </style>
</head>
<body>

    <h1>üê† 35g Reef Command Center</h1>

    <div class="tab-nav">
        <button class="tab-btn active" onclick="openTab('dashboard')">Dashboard</button>
        <button class="tab-btn" onclick="openTab('instructions')">Dosing Instructions</button>
    </div>

    <div id="dashboard" class="tab-content active">
        <div class="card" style="margin-bottom: 20px;">
            <h2>Current Status</h2>
            <div class="status-grid" id="statusDisplay">
                <div class="status-box warn">No Data</div>
            </div>
        </div>

        <div class="grid">
            <div class="card">
                <h2>üìù Add New Log</h2>
                <div class="form-group"><label>Date</label><input type="date" id="date"></div>
                <div class="form-group"><label>Alkalinity (dKH)</label><input type="number" step="0.1" id="alk"></div>
                <div class="form-group"><label>Calcium (ppm)</label><input type="number" id="ca"></div>
                <div class="form-group"><label>Magnesium (ppm)</label><input type="number" id="mg"></div>
                <div class="form-group"><label>Nitrate (ppm)</label><input type="number" step="0.1" id="no3"></div>
                <div class="form-group"><label>Phosphate (ppm)</label><input type="number" step="0.01" id="po4"></div>
                <div class="form-group"><label>pH</label><input type="number" step="0.1" id="ph"></div>
                <button onclick="addLog()">Save Entry</button>
            </div>

            <div class="card">
                <h2>üß™ Dosing Assistant</h2>
                <p>Calculate your daily Red Sea recipe based on Calcium uptake.</p>
                
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-bottom:15px;">
                    <div class="form-group">
                        <label>Current Ca (ppm)</label>
                        <input type="number" id="calcCurrentCa" placeholder="...">
                    </div>
                    <div class="form-group">
                        <label>Target Ca (ppm)</label>
                        <input type="number" id="calcTargetCa" value="430">
                    </div>
                </div>

                <button onclick="calculateDosing()">Calculate Recipe</button>
                <div id="calc-results"></div>
            </div>
        </div>

        <div class="card">
            <h2>üìà Trends</h2>
            <canvas id="tankChart"></canvas>
        </div>

        <div class="card" style="margin-top: 20px;">
            <h2>History</h2>
            <button class="delete" onclick="clearData()" style="width: auto; float: right; padding: 5px 10px;">Clear All Data</button>
            <table id="historyTable">
                <thead><tr><th>Date</th><th>Alk</th><th>Ca</th><th>Mg</th><th>NO3</th><th>PO4</th><th>pH</th></tr></thead>
                <tbody></tbody>
            </table>
        </div>
    </div>

    <div id="instructions" class="tab-content">
        <div class="card highlight">
            <h2>Foundation & Trace Elements</h2>
            <h3>Complete 4-part Supplement Program</h3>
            <p>This is an easy-dose program based on calcium uptake. All four parts are provided in a single pack and will finish at the same time.</p>
            
            <div class="grid-small">
                <div class="dose-card">
                    <div class="dose-label">Reef Care 1</div>
                    <div>Calcium & Magnesium+</div>
                    <div class="dose-chem">Ca | Mg | Sr | Ba</div>
                    <div class="dose-amt">3.7 ml</div>
                    <div>Daily</div>
                </div>

                <div class="dose-card">
                    <div class="dose-label">Reef Care 2</div>
                    <div>KH/Alkalinity & pH</div>
                    <div class="dose-chem">Alkalinity Components</div>
                    <div class="dose-amt">7.5 ml</div>
                    <div>Daily</div>
                </div>

                <div class="dose-card">
                    <div class="dose-label">Reef Care 3</div>
                    <div>Iodine & Potassium+</div>
                    <div class="dose-chem">I‚ÇÇ | Br‚ÇÇ | F‚ÇÇ | K & Trace</div>
                    <div class="dose-amt">1.9 ml</div>
                    <div>Daily</div>
                </div>

                <div class="dose-card">
                    <div class="dose-label">Reef Care 4</div>
                    <div>Iron & Bioactive</div>
                    <div class="dose-chem">Fe + 23 elements</div>
                    <div class="dose-amt">1.9 ml</div>
                    <div>Daily</div>
                </div>
            </div>

            <hr style="margin: 20px 0; border: 0; border-top: 1px solid #eee;">
            <p style="text-align: right; font-weight: bold; color: #555;">Avg. cost for your tank size/month: <span style="color: #28a745;">$10.12</span></p>
        </div>
    </div>

<script>
    // --- TABS LOGIC ---
    function openTab(tabId) {
        document.querySelectorAll('.tab-content').forEach(content => {
            content.classList.remove('active');
        });
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        document.getElementById(tabId).classList.add('active');
        const btn = Array.from(document.querySelectorAll('.tab-btn')).find(b => b.getAttribute('onclick').includes(tabId));
        if(btn) btn.classList.add('active');
    }

    // --- CONFIGURATION ---
    const TANK_VOL = 35; // gallons
    const CA_IMPACT_FACTOR = 1.51; // 1ml of RC1 raises 35g by ~1.51 ppm
    
    // RED SEA RATIOS (Derived from instructions)
    // Base: 3.7ml Part 1
    const RATIO_P2 = 7.5 / 3.7; // ~2.027
    const RATIO_P3 = 1.9 / 3.7; // ~0.5135
    const RATIO_P4 = 1.9 / 3.7; // ~0.5135

    // --- APP LOGIC ---
    let logs = JSON.parse(localStorage.getItem('reefLogs')) || [];
    const dateInput = document.getElementById('date');
    if(dateInput) dateInput.valueAsDate = new Date();

    function saveToStorage() {
        logs.sort((a, b) => new Date(a.date) - new Date(b.date));
        localStorage.setItem('reefLogs', JSON.stringify(logs));
        renderAll();
    }

    function addLog() {
        const entry = {
            date: document.getElementById('date').value,
            alk: parseFloat(document.getElementById('alk').value),
            ca: parseFloat(document.getElementById('ca').value),
            mg: parseFloat(document.getElementById('mg').value),
            no3: parseFloat(document.getElementById('no3').value),
            po4: parseFloat(document.getElementById('po4').value),
            ph: parseFloat(document.getElementById('ph').value)
        };

        if(!entry.date || !entry.alk) { alert("Date and Alkalinity are required!"); return; }
        
        logs.push(entry);
        saveToStorage();
        document.querySelectorAll('input[type=number]').forEach(i => i.value = '');
        document.getElementById('calcTargetCa').value = "430";
    }

    function clearData() {
        if(confirm("Are you sure you want to delete all history?")) {
            localStorage.removeItem('reefLogs');
            logs = [];
            renderAll();
        }
    }

    // --- VISUALIZATION ---
    let chartInstance = null;

    function renderAll() {
        renderTable();
        renderStatus();
        renderChart();
        if(logs.length > 0) {
            const last = logs[logs.length - 1];
            if(last.ca) document.getElementById('calcCurrentCa').value = last.ca;
        }
    }

    function renderTable() {
        const tbody = document.querySelector('#historyTable tbody');
        if(!tbody) return;
        tbody.innerHTML = '';
        [...logs].reverse().forEach(log => {
            const row = `<tr>
                <td>${log.date}</td>
                <td>${log.alk}</td>
                <td>${log.ca}</td>
                <td>${log.mg}</td>
                <td>${log.no3}</td>
                <td>${log.po4}</td>
                <td>${log.ph}</td>
            </tr>`;
            tbody.innerHTML += row;
        });
    }

    function renderStatus() {
        if (logs.length === 0) return;
        const last = logs[logs.length - 1];
        const display = document.getElementById('statusDisplay');
        function getStatus(val, min, max) { return (val >= min && val <= max) ? 'good' : 'bad'; }

        display.innerHTML = `
            <div class="status-box ${getStatus(last.alk, 8, 10)}">Alk: ${last.alk}</div>
            <div class="status-box ${getStatus(last.ca, 400, 450)}">Ca: ${last.ca}</div>
            <div class="status-box ${getStatus(last.no3, 2, 10)}">NO3: ${last.no3}</div>
        `;
    }

    function renderChart() {
        const ctx = document.getElementById('tankChart').getContext('2d');
        if (chartInstance) chartInstance.destroy();
        chartInstance = new Chart(ctx, {
            type: 'line',
            data: {
                labels: logs.map(l => l.date),
                datasets: [
                    { label: 'Alk (dKH)', data: logs.map(l => l.alk), borderColor: '#007bff', tension: 0.1 },
                    { label: 'Calcium (ppm)', data: logs.map(l => l.ca), borderColor: '#6f42c1', tension: 0.1 },
                    { label: 'Nitrate (ppm)', data: logs.map(l => l.no3), borderColor: '#28a745', tension: 0.1 }
                ]
            }
        });
    }

    // --- DOSING CALCULATOR LOGIC ---
    function calculateDosing() {
        const currentCa = parseFloat(document.getElementById('calcCurrentCa').value);
        const targetCa = parseFloat(document.getElementById('calcTargetCa').value);

        if (!currentCa || !targetCa) { alert("Please enter Current and Target Calcium."); return; }
        
        let planHTML = "";
        
        // 1. Calculate One-Time Correction
        const gap = targetCa - currentCa;
        let correctionMsg = "‚úÖ Levels match target.";
        if (Math.abs(gap) > 2) {
            const correctionMl = gap / CA_IMPACT_FACTOR;
            if (gap > 0) {
                correctionMsg = `üëâ <b>Correction Dose (Part 1):</b> Add <span class="calc-highlight">${correctionMl.toFixed(1)} mL</span> once.`;
                if(gap > 20) correctionMsg += ` <small style="color:red">(Split over 2 days)</small>`;
            } else {
                correctionMsg = `üëâ <b>Correction:</b> Levels high. Skip Part 1 today.`;
            }
        }

        // 2. Calculate New Daily Recipe based on Consumption
        let dailyP1 = 0;
        let consumptionMsg = "";
        
        if (logs.length >= 2) {
            const curL = logs[logs.length-1];
            const preL = logs[logs.length-2];
            const days = (new Date(curL.date) - new Date(preL.date)) / (1000*60*60*24);
            
            if(days > 0 && curL.ca && preL.ca) {
                const caLoss = preL.ca - curL.ca; // Positive means we lost Ca (consumed)
                // Note: This assumes NO dosing happened between logs. 
                // A true "Consumption" calc usually requires: (Start - End) + Dosed Amount.
                // Since we removed dosing input, we will estimate strictly on "Daily Drop".
                // Ideally: Users input their PREVIOUS dose to get exact consumption.
                // For now, we will just show the "Replacement Dose" for the observed drop.
                
                const dailyDrop = caLoss / days;
                
                if (dailyDrop > 0) {
                    dailyP1 = dailyDrop / CA_IMPACT_FACTOR;
                    consumptionMsg = `üìâ Tank is consuming ~${dailyDrop.toFixed(1)} ppm Ca/day.`;
                } else {
                    dailyP1 = 0; // Levels rising without dosing? Check water changes.
                    consumptionMsg = `üìà Levels rising (${Math.abs(dailyDrop).toFixed(1)} ppm/day). Zero daily dose recommended.`;
                }

                // Generate Recipe Table
                const p2 = dailyP1 * RATIO_P2;
                const p3 = dailyP1 * RATIO_P3;
                const p4 = dailyP1 * RATIO_P4;

                planHTML = `
                    <h3>New Daily Schedule</h3>
                    <p style="font-size:0.9em; margin-bottom:10px;">${consumptionMsg}</p>
                    <table class="recipe-table" style="background:white; border-radius:5px; border:1px solid #eee;">
                        <tr><td>Reef Care 1 (Ca)</td><td>${dailyP1.toFixed(1)} mL</td></tr>
                        <tr><td>Reef Care 2 (Alk)</td><td>${p2.toFixed(1)} mL</td></tr>
                        <tr><td>Reef Care 3 (Trace)</td><td>${p3.toFixed(1)} mL</td></tr>
                        <tr><td>Reef Care 4 (Bio)</td><td>${p4.toFixed(1)} mL</td></tr>
                    </table>
                `;

            } else {
                planHTML = `<p>‚ö†Ô∏è Not enough history to calculate daily consumption. Please log at least 2 entries separated by a few days.</p>`;
            }
        } else {
            planHTML = `<p>‚ö†Ô∏è Need 2+ logs to calculate a daily schedule.</p>`;
        }

        const resDiv = document.getElementById('calc-results');
        resDiv.style.display = 'block';
        resDiv.innerHTML = `
            ${planHTML}
            <hr>
            <p>${correctionMsg}</p>
        `;
    }

    renderAll();
</script>
    <script>
    // --- TABS LOGIC ---
    function openTab(tabId) {
        document.querySelectorAll('.tab-content').forEach(content => {
            content.classList.remove('active');
        });
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        document.getElementById(tabId).classList.add('active');
        const btn = Array.from(document.querySelectorAll('.tab-btn')).find(b => b.getAttribute('onclick').includes(tabId));
        if(btn) btn.classList.add('active');
    }

    // --- CONFIGURATION ---
    const TANK_VOL = 35; // gallons
    const CA_IMPACT_FACTOR = 1.51; // 1ml of RC1 raises 35g by ~1.51 ppm
    
    // RED SEA RATIOS
    const RATIO_P2 = 7.5 / 3.7; // ~2.027
    const RATIO_P3 = 1.9 / 3.7; // ~0.5135
    const RATIO_P4 = 1.9 / 3.7; // ~0.5135

    // --- APP LOGIC ---
    let logs = JSON.parse(localStorage.getItem('reefLogs')) || [];
    const dateInput = document.getElementById('date');
    if(dateInput) dateInput.valueAsDate = new Date();

    function saveToStorage() {
        logs.sort((a, b) => new Date(a.date) - new Date(b.date));
        localStorage.setItem('reefLogs', JSON.stringify(logs));
        renderAll();
    }

    function addLog() {
        const entry = {
            date: document.getElementById('date').value,
            alk: parseFloat(document.getElementById('alk').value),
            ca: parseFloat(document.getElementById('ca').value),
            mg: parseFloat(document.getElementById('mg').value),
            no3: parseFloat(document.getElementById('no3').value),
            po4: parseFloat(document.getElementById('po4').value),
            ph: parseFloat(document.getElementById('ph').value)
        };

        if(!entry.date || !entry.alk) { alert("Date and Alkalinity are required!"); return; }
        
        logs.push(entry);
        saveToStorage();
        document.querySelectorAll('input[type=number]').forEach(i => i.value = '');
        document.getElementById('calcTargetCa').value = "430";
    }

    function clearData() {
        if(confirm("Are you sure you want to delete all history?")) {
            localStorage.removeItem('reefLogs');
            logs = [];
            renderAll();
        }
    }

    // --- VISUALIZATION ---
    let chartInstance = null;

    function renderAll() {
        renderTable();
        renderStatus();
        renderChart();
        if(logs.length > 0) {
            const last = logs[logs.length - 1];
            if(last.ca) document.getElementById('calcCurrentCa').value = last.ca;
        }
    }

    function renderTable() {
        const tbody = document.querySelector('#historyTable tbody');
        if(!tbody) return;
        tbody.innerHTML = '';
        [...logs].reverse().forEach(log => {
            const row = `<tr>
                <td>${log.date}</td>
                <td>${log.alk}</td>
                <td>${log.ca}</td>
                <td>${log.mg}</td>
                <td>${log.no3}</td>
                <td>${log.po4}</td>
                <td>${log.ph}</td>
            </tr>`;
            tbody.innerHTML += row;
        });
    }

    function renderStatus() {
        if (logs.length === 0) return;
        const last = logs[logs.length - 1];
        const display = document.getElementById('statusDisplay');
        function getStatus(val, min, max) { return (val >= min && val <= max) ? 'good' : 'bad'; }

        display.innerHTML = `
            <div class="status-box ${getStatus(last.alk, 8, 10)}">Alk: ${last.alk}</div>
            <div class="status-box ${getStatus(last.ca, 400, 450)}">Ca: ${last.ca}</div>
            <div class="status-box ${getStatus(last.no3, 2, 10)}">NO3: ${last.no3}</div>
        `;
    }

    function renderChart() {
        const ctx = document.getElementById('tankChart').getContext('2d');
        if (chartInstance) chartInstance.destroy();
        chartInstance = new Chart(ctx, {
            type: 'line',
            data: {
                labels: logs.map(l => l.date),
                datasets: [
                    { label: 'Alk (dKH)', data: logs.map(l => l.alk), borderColor: '#007bff', tension: 0.1 },
                    { label: 'Calcium (ppm)', data: logs.map(l => l.ca), borderColor: '#6f42c1', tension: 0.1 },
                    { label: 'Nitrate (ppm)', data: logs.map(l => l.no3), borderColor: '#28a745', tension: 0.1 }
                ]
            }
        });
    }

    // --- HELPERS ---
    function generateRecipeHTML(baseP1) {
        const p2 = baseP1 * RATIO_P2;
        const p3 = baseP1 * RATIO_P3;
        const p4 = baseP1 * RATIO_P4;
        
        return `
            <table class="recipe-table" style="background:white; border-radius:5px; border:1px solid #eee;">
                <tr><td>Reef Care 1 (Ca)</td><td>${baseP1.toFixed(1)} mL</td></tr>
                <tr><td>Reef Care 2 (Alk)</td><td>${p2.toFixed(1)} mL</td></tr>
                <tr><td>Reef Care 3 (Trace)</td><td>${p3.toFixed(1)} mL</td></tr>
                <tr><td>Reef Care 4 (Bio)</td><td>${p4.toFixed(1)} mL</td></tr>
            </table>
        `;
    }

    // --- DOSING CALCULATOR LOGIC ---
    function calculateDosing() {
        const currentCa = parseFloat(document.getElementById('calcCurrentCa').value);
        const targetCa = parseFloat(document.getElementById('calcTargetCa').value);

        if (!currentCa || !targetCa) { alert("Please enter Current and Target Calcium."); return; }
        
        let planHTML = "";
        
        // 1. Calculate One-Time Correction
        const gap = targetCa - currentCa;
        let correctionMsg = "‚úÖ Levels match target.";
        if (Math.abs(gap) > 2) {
            const correctionMl = gap / CA_IMPACT_FACTOR;
            if (gap > 0) {
                correctionMsg = `üëâ <b>Correction Dose (Part 1 Only):</b> Add <span class="calc-highlight">${correctionMl.toFixed(1)} mL</span> once.<br><small style="color:#666">Do not dose Parts 2, 3, or 4 for this correction.</small>`;
                if(gap > 20) correctionMsg += ` <br><span style="color:red; font-weight:bold;">‚ö†Ô∏è Large shift! Split this dose over 2 days.</span>`;
            } else {
                correctionMsg = `üëâ <b>Correction:</b> Levels high. Skip Part 1 today.`;
            }
        }

        // 2. Calculate New Daily Recipe based on Consumption
        let dailyP1 = 0;
        
        if (logs.length >= 2) {
            const curL = logs[logs.length-1];
            const preL = logs[logs.length-2];
            const days = (new Date(curL.date) - new Date(preL.date)) / (1000*60*60*24);
            
            if(days > 0 && curL.ca && preL.ca) {
                const caLoss = preL.ca - curL.ca; // Positive means we lost Ca (consumed)
                const dailyDrop = caLoss / days;
                
                if (dailyDrop > 0) {
                    dailyP1 = dailyDrop / CA_IMPACT_FACTOR;
                    planHTML = `
                        <h3>New Daily Schedule</h3>
                        <p style="font-size:0.9em; margin-bottom:10px;">üìâ Tank is consuming ~${dailyDrop.toFixed(1)} ppm Ca/day.</p>
                        ${generateRecipeHTML(dailyP1)}
                    `;
                } else {
                    planHTML = `
                        <h3>New Daily Schedule</h3>
                        <p>üìà Levels rising (${Math.abs(dailyDrop).toFixed(1)} ppm/day).<br>Zero daily dose recommended.</p>
                    `;
                }
            } else {
                planHTML = `<p>‚ö†Ô∏è Not enough history to calculate daily consumption.</p>`;
            }
        } else {
            // MANUAL FALLBACK FOR NO DATA
            planHTML = `
                <h3>New Daily Schedule</h3>
                <p style="color:#d63384; font-size:0.9em;">‚ö†Ô∏è Need 2 logs to calculate consumption.</p>
                <div style="background:#fff3cd; padding:10px; border-radius:5px;">
                    <p style="margin:0 0 5px 0; font-size:0.9em;"><b>Estimate Recipe Manually:</b></p>
                    <input type="number" id="manualBase" placeholder="Enter planned Part 1 dose (mL)" style="margin-bottom:5px;">
                    <button onclick="renderManualRecipe()" style="padding:5px; font-size:0.9em;">Show Ratios</button>
                    <div id="manual-recipe-output" style="margin-top:10px;"></div>
                </div>
            `;
        }

        const resDiv = document.getElementById('calc-results');
        resDiv.style.display = 'block';
        resDiv.innerHTML = `
            ${planHTML}
            <hr>
            <p>${correctionMsg}</p>
        `;
    }

    function renderManualRecipe() {
        const val = parseFloat(document.getElementById('manualBase').value);
        if(val) {
            document.getElementById('manual-recipe-output').innerHTML = generateRecipeHTML(val);
        }
    }

    renderAll();
</script>
</body>
</html>
